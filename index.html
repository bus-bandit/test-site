<!DOCTYPE html>
<html>

<head>
    <script src="js/jquery-3.1.0.min.js"></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>

<style type="text/css">
    .h1 {
        text-align: center;
    }

    .titleContainer {
        text-align: left;
    }

    .rightAlign {
        text-align: right;
    }

    .btn {
        width: 90%;
        margin-left: 5%;
        margin-right: 5%;
    }

    p {
        white-space: nowrap;
        overflow: hidden;
        display: block;
        text-overflow: ellipsis;
        background-color: yellow;
    }


</style>

<body>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>

    <div class="h1">
        Wikipedia Viewer - Free Code Camp
    </div>

    <div class="container">
        <div class="row">

            <a class="col-sm-6 rightAlign" href="https://en.wikipedia.org/wiki/Special:Random" target="_blank">
                <span class="glyphicon glyphicon-random">
        </span> Random Wikipedia Article
            </a>

            <div class="col-sm-6">
                <span class="glyphicon glyphicon-search"></span>
                <input type="text" name="searchThis" placeholder="Search Wikipedia Articles" id="searchText" />
                <input type="button" value="Search!" id="searchButton" />

            </div>
            <div>
                <br />
                <br />
            </div>
            <div class="row" id="resultsList">

                <div class="col-xs-12">
                </div>

            </div>

        </div>
    </div>

</body>

<script>
//Listeners to check if user hit "Enter" or clicked "Search"
    $(document).ready(function() {
        $('#searchButton').click(wikiSearch);
        $('#searchText').on('keydown', function() {
            if (event.which === 13) {
                wikiSearch();
            }
        });
    });

//Peels out titles and snippets from JSON searchResults, loads them into containers and makes them into links disguised as buttons.
    function makeList(searchResults, resultsLength) {
        var titles = [];
        var snippets = [];
        $('#resultsList').html('');
        for (i = 0; i < resultsLength; i++) {
            titles[i] = searchResults.query.search[i]['title'];
            snippets[i] = searchResults.query.search[i]['snippet'];
            snippets[i] = snippets[i].concat('...');
        }
        //console.log(titles);
        //console.log(snippets);
        for (i = 0; i < resultsLength; i++) {
            var resultContainer = document.createElement('div');
            resultContainer.setAttribute('class', 'titleContainer');
            resultContainer.innerHTML = '<h4>' + titles[i] + '</h4><p>' + snippets[i] + '</p>';
            var linkButton = document.createElement('a');
            linkButton.setAttribute('class', 'btn btn-default');
            linkButton.setAttribute('href', 'https://en.wikipedia.org/wiki/' + encodeURIComponent(titles[i]));
            linkButton.setAttribute('target', '_blank');
            linkButton.appendChild(resultContainer);
            document.getElementById('resultsList').appendChild(linkButton);
        }

    }

//Verify that there are indeed results from the search.  Post error if no search results, otherwise fire it to makeList().
    function verifyJSON(data) {
        var searchResults = data;
        console.log(searchResults);
        var resultsLength = Object.keys(searchResults.query.search).length;
        console.log(resultsLength);
        if (resultsLength === 0) {
            document.getElementById('resultsList').innerHTML = 'Sorry, no results found.';
        } else {
            makeList(searchResults, resultsLength);
        }
    }

//AJAX request to wikipedia using input from search field and firing it to verifyJSON().
    function wikiSearch() {
        var data = [];
        var searchFor = document.getElementById("searchText").value;
        $.getJSON('https://en.wikipedia.org/w/api.php?action=query&format=json&callback=?&list=search&srsearch=' + encodeURIComponent(searchFor), function(data) {
            verifyJSON(data);
        });
        var results = [];
    }
</script>

</html>
